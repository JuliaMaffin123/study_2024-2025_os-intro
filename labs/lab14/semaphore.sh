#!/bin/bash

# Имя файла блокировки
LOCK_FILE="/tmp/my_lock_file"
# Времена ожидания и использования ресурса
T1=$1  # время ожидания (задержка перед попыткой захвата ресурса)
T2=$2  # время использования ресурса
# Текущий идентификатор процесса
PID="$$"
# Логируем статус
log_status() {
    echo "[$(date)] Process $PID: $@"
}
# Проверяем доступность ресурса и пытаемся захватить его
log_status "Ожидаю освобождения ресурса в течение $T1 секунды(-секунд)"
if ! flock -n -w "$T1" "$LOCK_FILE"; then
    log_status "Ресурс не освободился за отведённое время ($T1 сек.). Завершаюсь."
    exit 1
else
    log_status "Ресурс захвачен!"
fi
# Используем ресурс в течение T2 секунд
log_status "Начинаю использовать ресурс в течение $T2 секунды(-секунд)"
sleep "$T2"
# Освобождаем ресурс
log_status "Освободил ресурс"
# Убираем блокировку (не обязательно, поскольку она автоматическая)
rm -f "$LOCK_FILE"
